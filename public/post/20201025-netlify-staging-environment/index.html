<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.131b48b25a50eff60b34.css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><meta name="generator" content="Gatsby 2.24.63"/><style data-styled="" data-styled-version="5.2.0">.fhyUES{color:#595959;text-align:center;}/*!sc*/
data-styled.g1[id="footer__Footer-sc-8chkdg-0"]{content:"fhyUES,"}/*!sc*/
.cnZbXV{max-width:960px;padding:0 1.1rem 1.45rem;margin:0 auto;font-family:-apple-system,BlinkMacSystemFont,'Hiragino Kaku Gothic ProN',Meiryo,sans-serif;}/*!sc*/
data-styled.g2[id="layout__Layout-sc-1k7q7u2-0"]{content:"cnZbXV,"}/*!sc*/
.dFCEWM > a{-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
.dFCEWM > a > span{font-size:1.5rem;font-weight:bold;color:#000;}/*!sc*/
data-styled.g6[id="header__Header-adu8l-0"]{content:"dFCEWM,"}/*!sc*/
.hxczXj > main > section > div.post-header,.hxczXj > main > section > div.post-body{max-width:700px;margin:80px auto;}/*!sc*/
.hxczXj > main > section > img{width:100%;height:100%;max-height:450px;box-shadow:rgba(0,0,0,0.2) 0 30px 60px -10px,rgba(0,0,0,0.22) 0 18px 36px -18px;object-fit:cover;}/*!sc*/
.hxczXj > main > section > div > time{color:#434343;}/*!sc*/
.hxczXj > main > section > div.post-header > p{color:#434343;overflow-wrap:break-word;}/*!sc*/
.hxczXj > main > section > div.post-body > pre{overflow:scroll;}/*!sc*/
.hxczXj > main > section > div.post-body > p > img{width:100%;height:auto;}/*!sc*/
.hxczXj > main > section > div.post-body > h2{margin-top:100px;}/*!sc*/
.hxczXj > main > section > div.post-body > h3{margin-top:50px;}/*!sc*/
.hxczXj > main > section > div.post-body > h4{margin-top:25px;}/*!sc*/
.hxczXj > main > section > div.post-body > p > code{color:#2d2d2d;background:#ccc;}/*!sc*/
data-styled.g7[id="post__Post-sc-1645max-0"]{content:"hxczXj,"}/*!sc*/
</style><link as="script" rel="preload" href="/webpack-runtime-6ce96a7a5c2c7dc5f86d.js"/><link as="script" rel="preload" href="/framework-eba153ab51c1c5913846.js"/><link as="script" rel="preload" href="/app-0663de5069d6506e61e4.js"/><link as="script" rel="preload" href="/styles-cd63080e784be7b7e7cf.js"/><link as="script" rel="preload" href="/commons-8b1a69f191b07e76cbeb.js"/><link as="script" rel="preload" href="/component---src-templates-post-tsx-f064344779944c1ba6dc.js"/><link as="fetch" rel="preload" href="/page-data/post/20201025-netlify-staging-environment/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout__Layout-sc-1k7q7u2-0 cnZbXV post__Post-sc-1645max-0 hxczXj"><main><header class="header__Header-adu8l-0 dFCEWM"><a href="/"><span role="img" aria-label="icon">💡</span><span>gntk.dev</span></a></header><section><div class="post-header"><h1>Netlifyでステージング環境を用意する</h1><p>実機での表示確認など、ローカル環境では確認できない検証があるときはステージング環境が必要になります。NetlifyとGithubを連携させれば、PRを作るごとに自動でステージング環境が用意できます。</p><time>2020年10月25日</time></div><img src="//images.ctfassets.net/t8kgtqnqij4r/4ocfV6ZLl0fsQjgtmMTqfZ/f342d3106aea5edcdf29c6eeef5d1400/PR____________________________________________________________1_.png" alt="post-cover"/><div class="post-body"><h2>ステージング環境を作ろうと思った経緯</h2>
<p>昨日、記念すべき（？）<a href="https://gntk.dev/post/20201023-my-first-post">初投稿の記事</a>を公開しましたが、公開後に早速問題発覚しました。
公開した記事をiPhoneで表示確認したところ、サイト上のテキストがすべて（ゴシック体になる想定だったが）明朝体になってしまっていました。（スクショ撮っておけばよかった…次から気をつける）</p>
<p>一応PC/SP両方で見れるように画面を作っており、Chromeのデベロッパーツールで表示確認などもしていました。デベロッパーツール上ではPCもSPもゴシック体で表示されていたためヨシ！で公開してしまいましたが、iPhoneの実機だと明朝体になってしまっていました。
想定外のフォントが表示されてしまった原因は、すべてのテキストに全く<code class="language-text">font-family</code>を設定していなかったことです（当然）。<code class="language-text">font-family</code>を指定しなかった場合、フォントはブラウザに任せるかんじになってしまうので、公開前に検証をしたmacOSのChromeだとゴシック体で表示されて、公開後に検証したiOSのChromeやSafariだと（おそらくヒラギノ）明朝で表示されたということですね。</p>
<p>公開してからじゃないと検証できない事項があるのダメだな…と思いしばらく悩んだのですが、「ステージング環境用意すればいいやん」と気付けました。ふだんから本業で散々やってることなのになぜすぐ思いつかなかったのか…。</p>
<h2>Netlifyでステージング環境を用意する</h2>
<p>NetlifyとGithubとを連携させると、Githubリポジトリのmasterブランチにpushもしくは他ブランチをmergeしたタイミングで変更が自動的にビルド・デプロイされます。
Netlifyでは、master以外のブランチを別の環境にデプロイすることもできます。
NetlifyのSite overviewから<code class="language-text">Site settings &gt; Build &amp; deploy &gt; Continuous Deployment &gt; Deploy contexts</code>から、master以外にデプロイしたいブランチを設定することができます。
<img src="//images.ctfassets.net/t8kgtqnqij4r/6J1SRotKAoLqteHVGsK3ZO/b816659514ac237e3dd182f631cbbe1b/____________________________2020-10-25_17.39.51.png" alt="20201025_Netlify設定画面">
この設定は、新たに<code class="language-text">dev</code>ブランチをデプロイするようにする設定です。</p>
<h2>修正→PR作成→実機で確認</h2>
<h3>1. font-familyが設定されていない件を修正する</h3>
<p>Reactコンポーネントに下記のスタイルをあてます。</p>
<div class="gatsby-highlight" data-language="css"><pre class="language-css"><code class="language-css">  <span class="token property">font-family</span><span class="token punctuation">:</span> -apple-system<span class="token punctuation">,</span> BlinkMacSystemFont<span class="token punctuation">,</span> <span class="token string">'Hiragino Kaku Gothic ProN'</span><span class="token punctuation">,</span> Meiryo<span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span></code></pre></div>
<h3>2. 変更をdevブランチにmergeする</h3>
<p>業務で慣れていることもあり、一人開発ではありますがGit flowでブランチ運用しています。上記の修正は<code class="language-text">feature/xxxxxx</code>みたいなブランチでPRを作り、<code class="language-text">dev</code>にマージします。</p>
<p>変更が<code class="language-text">dev</code>にマージされたら、<code class="language-text">dev</code>を<code class="language-text">master</code>にマージするPRを作ります。すると、GithubのPRの画面に下記のようにビルド・デプロイの進捗が表示されます。（merge→PR closeしてしまってから記事を書いているので、また画像がない…；；参考サイトから引用しています）
<img src="//images.ctfassets.net/t8kgtqnqij4r/6x5dm5tgRqqqf5hhR4xpQv/9cf17aef41843d4beed195d3861319ee/netlify-deploy-contexts-05.png" alt="20201025_Netlifyのビルド・デプロイ進捗">
画像の赤矢印のリンクを踏むと、<code class="language-text">dev</code>をビルド・デプロイしたステージング環境にアクセスできます。</p>
<h3>3. 実機で確認する</h3>
<p><a href="https://chrome.google.com/webstore/detail/the-qr-code-extension/oijdcdmnjjgnnhgljmhkjlablaejfeeb?hl=ja">Chromeの拡張</a>でQRコード表示してiPhoneからステージング環境にアクセスするなどすれば、確認できます。
<img src="//images.ctfassets.net/t8kgtqnqij4r/3nq6MpppxRv5XVIMYVL75/cf40bc1519cb692ac7b24ca065cb2041/unnamed.png" alt="20201025_iPhoneのスクショ">
めでたしめでたし。</p>
<h2>[余談]アイキャッチ画像作成が楽勝だった話</h2>
<p>前回のポストに「サムネイル用意するのめんどくさい…」と書きましたが、<a href="https://www.canva.com/">Canva</a>っていうサービス使ったら楽勝でした。素材もたくさんあるし文字も簡単に入れられるし、最高やんけ！</p>
<h2>参考</h2>
<p><a href="https://microcms.io/blog/netlify-deploy-contexts/">https://microcms.io/blog/netlify-deploy-contexts/</a></p></div></section></main><footer class="footer__Footer-sc-8chkdg-0 fhyUES">© <!-- -->2020<!-- --> gntk.dev</footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/post/20201025-netlify-staging-environment/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-81c261df04a8297433a1.js"],"app":["/app-0663de5069d6506e61e4.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-dac03547273bc48a6940.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-8d0682b3424d883b44c9.js"],"component---src-templates-post-tsx":["/component---src-templates-post-tsx-f064344779944c1ba6dc.js"]};/*]]>*/</script><script src="/polyfill-81c261df04a8297433a1.js" nomodule=""></script><script src="/component---src-templates-post-tsx-f064344779944c1ba6dc.js" async=""></script><script src="/commons-8b1a69f191b07e76cbeb.js" async=""></script><script src="/styles-cd63080e784be7b7e7cf.js" async=""></script><script src="/app-0663de5069d6506e61e4.js" async=""></script><script src="/framework-eba153ab51c1c5913846.js" async=""></script><script src="/webpack-runtime-6ce96a7a5c2c7dc5f86d.js" async=""></script></body></html>